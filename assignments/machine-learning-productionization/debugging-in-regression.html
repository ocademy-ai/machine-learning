
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>38.40. Case Study: Debugging in Regression &#8212; Machine Learning Open Course</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/drawio.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/youtube.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "open-academy/machine-learning-utterances");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "üí¨ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"></script>
    <script>quizdown.init({"quizdown_js": "https://cdn.jsdelivr.net/gh/bonartm/quizdown-js@latest/public/build/quizdown.js"});</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="39. Slides" href="../../slides/introduction.html" />
    <link rel="prev" title="38.39. Case Study: Debugging in Classification" href="debugging-in-classification.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Machine Learning Open Course</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  PREREQUISITES
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-introduction.html">
   1. Python programming introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-basics.html">
   2. Python programming basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../prerequisites/python-programming-advanced.html">
   3. Python programming advanced
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DATA SCIENCE
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/introduction/introduction.html">
   4. Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/defining-data-science.html">
     4.1. Defining data science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/data-science-ethics.html">
     4.2. Data Science ethics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/defining-data.html">
     4.3. Defining data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/introduction/introduction-to-statistics-and-probability.html">
     4.4. Introduction to statistics and probability
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/working-with-data/working-with-data.html">
   5. Working with data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/relational-databases.html">
     5.1. Relational databases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/non-relational-data.html">
     5.2. Non-relational data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/numpy.html">
     5.3. NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/pandas.html">
     5.4. Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/working-with-data/data-preparation.html">
     5.5. Data preparation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-visualization/data-visualization.html">
   6. Data visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualizing-quantities.html">
     6.1. Visualizing quantities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-distributions.html">
     6.2. Visualizing distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-proportions.html">
     6.3. Visualizing proportions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/visualization-relationships.html">
     6.4. Visualizing relationships: all about honey üçØ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-visualization/meaningful-visualizations.html">
     6.5. Making meaningful visualizations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-science-lifecycle/data-science-lifecycle.html">
   7. Data Science lifecycle
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/introduction.html">
     7.1. Introduction to the Data Science lifecycle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/analyzing.html">
     7.2. Analyzing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-lifecycle/communication.html">
     7.3. Communication
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data-science/data-science-in-the-cloud/data-science-in-the-cloud.html">
   8. Data Science in the cloud
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/introduction.html">
     8.1. Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/the-low-code-no-code-way.html">
     8.2. The ‚Äúlow code/no code‚Äù way
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data-science/data-science-in-the-cloud/the-azure-ml-sdk-way.html">
     8.3. Data Science in the cloud: The ‚ÄúAzure ML SDK‚Äù way
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-science/data-science-in-the-wild.html">
   9. Data Science in the real world
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ADVANCED MACHINE LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ml-advanced/clustering/clustering-models-for-machine-learning.html">
   10. Clustering models for Machine Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/kernel-method.html">
   11. Kernel method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/model-selection.html">
   12. Model selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/ensemble-learning.html">
   13. Ensemble learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/unsupervised-learning.html">
   14. Unsupervised learning (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ml-advanced/generative-models.html">
   15. Generative models
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DEEP LEARNING
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/dl-overview.html">
   16. Deep learning overview (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/CNN.html">
   17. CNN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/GAN.html">
   18. GAN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/RNN.html">
   19. RNN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/AutoEncoder.html">
   20. Autoencoder (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/LSTM.html">
   21. LSTM (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/NLP.html">
   22. NLP (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/time-series.html">
   23. Time series (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/DQN.html">
   24. DQN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../deep-learning/dl-summary.html">
   25. Summary of deep learning (TBD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MACHINE LEARNING PRODUCTIONIZATION
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/overview.html">
   26. Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/problem-framing.html">
   27. Problem framing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/data-engineering.html">
   28. Data engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/model-training-and-evaluation.html">
   29. Model training &amp; evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../machine-learning-productionization/model-deployment.html">
   30. Model deployment
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  SUPPORTING MATERIALS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/pytorch.html">
   31. PyTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/bamboolib.html">
   32. Bamboolib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/mito.html">
   33. Mito
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/KNN.html">
   34. KNN (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/semi-supervised-learning.html">
   35. Semi-supervised learning (TBD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/unbalanced-problems.html">
   36. Unbalanced problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../supporting-materials/automl.html">
   37. AutoML (TBD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  OTHERS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../introduction.html">
   38. Assignments
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../get-started.html">
     38.1. Get started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../set-up-env/first-assignment.html">
     38.2. First assignment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../set-up-env/second-assignment.html">
     38.3. Second assignment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-introduction.html">
     38.4. Python programming introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-basics.html">
     38.5. Python programming basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../prerequisites/python-programming-advanced.html">
     38.6. Python programming advanced
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-text-about-data-science.html">
     38.7. Analyzing text about Data Science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-scenarios.html">
     38.8. Data Science scenarios
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/write-a-data-ethics-case-study.html">
     38.9. Write a data ethics case study
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/lines-scatters-and-bars.html">
     38.10. Lines, scatters and bars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/apply-your-skills.html">
     38.11. Apply your skills
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/try-it-in-excel.html">
     38.12. Try it in Excel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/let-us-learn-about-birds.html">
     38.13. Let‚Äôs learn about birds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/bird-distributions.html">
     38.14. Bird distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/dive-into-the-beehive.html">
     38.15. Dive into the beehive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/build-your-own-custom-vis.html">
     38.16. Build your own custom vis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/classifying-datasets.html">
     38.17. Classifying datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/small-diabetes-study.html">
     38.18. Small diabetes study
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/introduction-to-statistics-and-probability.html">
     38.19. Introduction to probability and statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/displaying-airport-data.html">
     38.20. Displaying airport data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/soda-profits.html">
     38.21. Soda profits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-COVID-19-papers.html">
     38.22. Analyzing COVID-19 papers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/estimation-of-COVID-19-pandemic.html">
     38.23. Estimation of COVID-19 pandemic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-processing-in-python.html">
     38.24. Data processing in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/evaluating-data-from-a-form.html">
     38.25. Evaluating data from a form
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-preparation.html">
     38.26. Data preparation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/analyzing-data.html">
     38.27. Analyzing data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/nyc-taxi-data-in-winter-and-summer.html">
     38.28. NYC taxi data in winter and summer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/tell-a-story.html">
     38.29. Tell a story
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/explore-a-planetary-computer-dataset.html">
     38.30. Explore a planetary computer dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/exploring-for-anwser.html">
     38.31. Exploring for answers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/market-research.html">
     38.32. Market research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/low-code-no-code-data-science-project-on-azure-ml.html">
     38.33. Low code/no code Data Science project on Azure ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-project-using-azure-ml-sdk.html">
     38.34. Data Science project using Azure ML SDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-science/data-science-in-the-cloud-the-azure-ml-sdk-way.html">
     38.35. Data Science in the cloud: The ‚ÄúAzure ML SDK‚Äù way
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../project-plan-template.html">
     38.36. Project Plan‚Äã Template
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data-engineering.html">
     38.37. Data engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="counterintuitive-challenges-in-ml-debugging.html">
     38.38. Counterintuitive Challenges in ML Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="debugging-in-classification.html">
     38.39. Case Study: Debugging in Classification
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     38.40. Case Study: Debugging in Regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../slides/introduction.html">
   39. Slides
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-introduction.html">
     39.1. Python programming introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-basics.html">
     39.2. Python programming basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-programming-advanced.html">
     39.3. Python programming advanced
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-in-data-science.html">
     39.6. Python in Data Science
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../slides/python-programming/python-in-data-visualization.html">
     39.7. Python in data visualization
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/open-academy/machine-learning/main?urlpath=tree/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/open-academy/machine-learning/blob/main/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/open-academy/machine-learning/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/open-academy/machine-learning//issues/new?title=Issue%20on%20page%20%2Fassignments/machine-learning-productionization/debugging-in-regression.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/open-academy/machine-learning/edit/main/open-machine-learning-jupyter-book/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/assignments/machine-learning-productionization/debugging-in-regression.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   38.40.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-correlation-matrix">
   38.40.2. Check Correlation Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-input-data-against-data-schema">
   38.40.3. Validate Input Data against Data Schema
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     38.40.3.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-normalize-data">
   38.40.4. Split and Normalize Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-engineered-data">
   38.40.5. Test Engineered Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">
   38.40.6. Check Splits for Statistical Equivalence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-a-baseline">
   38.40.7. Establish a Baseline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-model">
   38.40.8. Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hint">
     38.40.8.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     38.40.8.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-feature-to-linear-model">
   38.40.9. Add Feature to Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     38.40.9.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-a-nonlinear-model">
   38.40.10. Use a Nonlinear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     38.40.10.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimize-your-model">
   38.40.11. Optimize Your Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     38.40.11.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     38.40.11.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">
   38.40.12. Check for Implementation Bugs using Reduced Dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     38.40.12.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trying-a-very-complex-model">
   38.40.13. Trying a Very Complex Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     38.40.13.1. Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   38.40.14. Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Case Study: Debugging in Regression</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   38.40.1. Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-correlation-matrix">
   38.40.2. Check Correlation Matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-input-data-against-data-schema">
   38.40.3. Validate Input Data against Data Schema
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution">
     38.40.3.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-and-normalize-data">
   38.40.4. Split and Normalize Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-engineered-data">
   38.40.5. Test Engineered Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">
   38.40.6. Check Splits for Statistical Equivalence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-a-baseline">
   38.40.7. Establish a Baseline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-model">
   38.40.8. Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hint">
     38.40.8.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     38.40.8.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-feature-to-linear-model">
   38.40.9. Add Feature to Linear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     38.40.9.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-a-nonlinear-model">
   38.40.10. Use a Nonlinear Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     38.40.10.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimize-your-model">
   38.40.11. Optimize Your Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     38.40.11.1. Hint
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     38.40.11.2. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">
   38.40.12. Check for Implementation Bugs using Reduced Dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     38.40.12.1. Solution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trying-a-very-complex-model">
   38.40.13. Trying a Very Complex Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#results">
     38.40.13.1. Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   38.40.14. Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><strong>Copyright 2018 Google LLC.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="case-study-debugging-in-regression">
<h1><span class="section-number">38.40. </span>Case Study: Debugging in Regression<a class="headerlink" href="#case-study-debugging-in-regression" title="Permalink to this headline">#</a></h1>
<p>In this Colab, you will learn how to debug a regression problem through a case study. You will:</p>
<ol class="simple">
<li><p>Set up the problem.</p></li>
<li><p>Interpret the correlation matrix.</p></li>
<li><p>Implement linear and nonlinear models.</p></li>
<li><p>Compare and choose between linear and nonlinear models.</p></li>
<li><p>Optimize your chosen model.</p></li>
<li><p>Debug your chosen model.</p></li>
</ol>
<section id="setup">
<h2><span class="section-number">38.40.1. </span>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">#</a></h2>
<p>This Colab uses the wine quality dataset&lt;sup#[1]&lt;/sup#, which is hosted at <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/wine+quality">UCI</a>. This dataset contains data on the physicochemical properties of wine along with wine quality ratings. The problem is to predict wine quality (0-10) from physicochemical properties.</p>
<p>Please <strong>make a copy</strong> of this Colab before running it. Click on <em>File</em>, and then click on <em>Save a copy in Drive</em>.</p>
<p>&lt;small#[1] Modeling wine preferences by data mining from physicochemical properties. P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Decision Support Systems, Elsevier, 47(4):547-553, 2009.&lt;/small#</p>
<p>Load libraries and data by running the next cell. Display the first few rows to verify that the dataset loaded correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Reset environment for a new run
%reset -f

# Load libraries
from os.path import join # for joining file pathnames
import pandas as pd
import seaborn as sns
import tensorflow as tf
from tensorflow import keras
import numpy as np
import matplotlib.pyplot as plt

# Set Pandas display options
pd.options.display.max_rows = 10
pd.options.display.float_format = &#39;{:.1f}&#39;.format

wineDf = pd.read_csv(
  &quot;https://download.mlcc.google.com/mledu-datasets/winequality.csv&quot;,
  encoding=&#39;latin-1&#39;)
wineDf.columns = [&#39;fixed acidity&#39;,&#39;volatile acidity&#39;,&#39;citric acid&#39;,
                     &#39;residual sugar&#39;,&#39;chlorides&#39;,&#39;free sulfur dioxide&#39;,
                     &#39;total sulfur dioxide&#39;,&#39;density&#39;,&#39;pH&#39;,
                     &#39;sulphates&#39;,&#39;alcohol&#39;,&#39;quality&#39;]
wineDf.head()
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-correlation-matrix">
<h2><span class="section-number">38.40.2. </span>Check Correlation Matrix<a class="headerlink" href="#check-correlation-matrix" title="Permalink to this headline">#</a></h2>
<p>Before developing your ML model, you need to select features. To find informative features, check the correlation matrix by running the following cell. Which features are informative?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>corr_wineDf = wineDf.corr()
plt.figure(figsize=(16,10))
sns.heatmap(corr_wineDf, annot=True)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">alcohol</span></code> is most highly correlated with <code class="docutils literal notranslate"><span class="pre">quality</span></code>. Looking for other informative features, notice that <code class="docutils literal notranslate"><span class="pre">volatile</span> <span class="pre">acidity</span></code> correlates with <code class="docutils literal notranslate"><span class="pre">quality</span></code> but not with <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>, making it a good second feature. Remember that a correlation matrix is not helpful if predictive signals are encoded in combinations of features.</p>
</section>
<section id="validate-input-data-against-data-schema">
<h2><span class="section-number">38.40.3. </span>Validate Input Data against Data Schema<a class="headerlink" href="#validate-input-data-against-data-schema" title="Permalink to this headline">#</a></h2>
<p>Before processing your data, you should validate the data against a data schema as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>.</p>
<p>First, define a function that validates data against a schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#@title Define function to validate data

def test_data_schema(input_data, schema):
  &quot;&quot;&quot;Tests that the datatypes and ranges of values in the dataset
    adhere to expectations.

    Args:
      input_function: Dataframe containing data to test
      schema: Schema which describes the properties of the data.
  &quot;&quot;&quot;

  def test_dtypes():
    for column in schema.keys():
      assert input_data[column].map(type).eq(
          schema[column][&#39;dtype&#39;]).all(), (
          &quot;Incorrect dtype in column &#39;%s&#39;.&quot; % column
      )
    print(&#39;Input dtypes are correct.&#39;)

  def test_ranges():
    for column in schema.keys():
      schema_max = schema[column][&#39;range&#39;][&#39;max&#39;]
      schema_min = schema[column][&#39;range&#39;][&#39;min&#39;]
      # Assert that data falls between schema min and max.
      assert input_data[column].max() &lt;= schema_max, (
          &quot;Maximum value of column &#39;%s&#39; is too low.&quot; % column
      )
      assert input_data[column].min() #= schema_min, (
          &quot;Minimum value of column &#39;%s&#39; is too high.&quot; % column
      )
    print(&#39;Data falls within specified ranges.&#39;)

  test_dtypes()
  test_ranges()
</pre></div>
</div>
</div>
</div>
<p>To define your schema, you need to understand the statistical properties of your dataset. Generate statistics on your dataset by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wineDf.describe()
</pre></div>
</div>
</div>
</div>
<p>Using the statistics generated above, define the data schema in the following code cell. For demonstration purposes, restrict your data schema to the first three data columns. For each data column, enter the:</p>
<ul class="simple">
<li><p>minimum value</p></li>
<li><p>maximum value</p></li>
<li><p>data type</p></li>
</ul>
<p>As an example, the values for the first column are filled out. After entering the values, run the code cell to confirm that your input data matches the schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wine_schema = {
    &#39;fixed acidity&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: 3.8,
            &#39;max&#39;: 15.9
        },
        &#39;dtype&#39;: float,
    },
    &#39;volatile acidity&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: , # describe() rounds up this value, be careful
            &#39;max&#39;:
        },
        &#39;dtype&#39;: ,
    },
    &#39;citric acid&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: ,
            &#39;max&#39;:
        },
        &#39;dtype&#39;: ,
    }
}

print(&#39;Validating wine data against data schema...&#39;)
test_data_schema(wineDf, wine_schema)
</pre></div>
</div>
</div>
</div>
<section id="solution">
<h3><span class="section-number">38.40.3.1. </span>Solution<a class="headerlink" href="#solution" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wine_schema = {
    &#39;fixed acidity&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: 3.7,
            &#39;max&#39;: 15.9
        },
        &#39;dtype&#39;: float,
    },
    &#39;volatile acidity&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: 0.08,  # minimum value
            &#39;max&#39;: 1.6   # maximum value
        },
        &#39;dtype&#39;: float,    # data type
    },
    &#39;citric acid&#39;: {
        &#39;range&#39;: {
            &#39;min&#39;: 0.0, # minimum value
            &#39;max&#39;: 1.7  # maximum value
        },
        &#39;dtype&#39;: float,   # data type
    }
}

print(&#39;Validating wine data against data schema...&#39;)
test_data_schema(wineDf, wine_schema)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="split-and-normalize-data">
<h2><span class="section-number">38.40.4. </span>Split and Normalize Data<a class="headerlink" href="#split-and-normalize-data" title="Permalink to this headline">#</a></h2>
<p>Split the dataset into data and labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wineFeatures = wineDf.copy(deep=True)
wineFeatures.drop(columns=&#39;quality&#39;,inplace=True)
wineLabels = wineDf[&#39;quality&#39;].copy(deep=True)
</pre></div>
</div>
</div>
</div>
<p>Normalize data using z-score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def normalizeData(arr):
  stdArr = np.std(arr)
  meanArr = np.mean(arr)
  arr = (arr-meanArr)/stdArr
  return arr

for str1 in wineFeatures.columns:
   wineFeatures[str1] = normalizeData(wineFeatures[str1])
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-engineered-data">
<h2><span class="section-number">38.40.5. </span>Test Engineered Data<a class="headerlink" href="#test-engineered-data" title="Permalink to this headline">#</a></h2>
<p>After normalizing your data, you should test your engineered data for errors as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>. In this section, you will test that engineering data:</p>
<ul class="simple">
<li><p>Has the expected number of rows and columns.</p></li>
<li><p>Does not have null values.</p></li>
</ul>
<p>First, set up the testing functions by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import unittest

def test_input_dim(df, n_rows, n_columns):
  assert len(df) == n_rows, &quot;Unexpected number of rows.&quot;
  assert len(df.columns) == n_columns, &quot;Unexpected number of columns.&quot;
  print(&#39;Engineered data has the expected number of rows and columns.&#39;)

def test_nulls(df):
  dataNulls = df.isnull().sum().sum()
  assert dataNulls == 0, &quot;Nulls in engineered data.&quot;
  print(&#39;Engineered features do not contain nulls.&#39;)
</pre></div>
</div>
</div>
</div>
<p>Your input data had 6497 examples and 11 feature columns. Test whether your engineered data has the expected number of rows and columns by running the following cell. Confirm that the test fails if you change the values below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#@title Test dimensions of engineered data
wine_feature_rows = 6497 #@param
wine_feature_cols = 11 #@param
test_input_dim(wineFeatures,
               wine_feature_rows,
               wine_feature_cols)
</pre></div>
</div>
</div>
</div>
<p>Test that your engineered data does not contain nulls by running the code below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_nulls(wineFeatures)
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-splits-for-statistical-equivalence">
<h2><span class="section-number">38.40.6. </span>Check Splits for Statistical Equivalence<a class="headerlink" href="#check-splits-for-statistical-equivalence" title="Permalink to this headline">#</a></h2>
<p>As described in the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data Debugging</a> guidelines, before developing your model, you should check that your training and validation splits are equally representative. Assuming a training:validation split of 80:20, compare the mean and the standard deviation of the splits by running the next two code cells. Note that this comparison is not a rigorous test for statistical equivalence but simply a quick and dirty comparison of the splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>splitIdx = wineFeatures.shape[0]*8/10
wineFeatures.iloc[0:splitIdx,:].describe()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wineFeatures.iloc[splitIdx:-1,:].describe()
</pre></div>
</div>
</div>
</div>
<p>The two splits are clearly not equally representative. To make the splits equally representative, you can shuffle the data.</p>
<p>Run the following code cell to shuffle the data, and then recreate the features and labels from the shuffled data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Shuffle data
wineDf = wineDf.sample(frac=1).reset_index(drop=True)
# Recreate features and labels
wineFeatures = wineDf.copy(deep=True)
wineFeatures.drop(columns=&#39;quality&#39;,inplace=True)
wineLabels = wineDf[&#39;quality&#39;].copy(deep=True)
</pre></div>
</div>
</div>
</div>
<p>Now, confirm that the splits are equally representative by regenerating and comparing the statistics using the previous code cells. You may wonder why the initial splits differed so greatly. It turns out that in the wine dataset, the first 4897 rows contain data on white wines and the next 1599 rows contain data on red wines. When you split your dataset 80:20, then your training dataset contains 5197 examples, which is 94% white wine. The validation dataset is purely red wine.</p>
<p>Ensuring your splits are statistically equivalent is a good development practice. In general, following good development practices will simplify your model debugging. To learn about testing for statistical equivalence, see <a class="reference external" href="https://journals.sagepub.com/doi/10.1177/1948550617697177">Equivalence Tests Lakens, D.</a>.</p>
</section>
<section id="establish-a-baseline">
<h2><span class="section-number">38.40.7. </span>Establish a Baseline<a class="headerlink" href="#establish-a-baseline" title="Permalink to this headline">#</a></h2>
<p>For a regression problem, the simplest baseline to predict the average value. Run the following code to calculate the mean-squared error (MSE) loss on the training split using the average value as a baseline. Your loss is approximately 0.75. Any model should beat this loss to justify its use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>baselineMSE = np.square(wineLabels[0:splitIdx]-np.mean(wineLabels[0:splitIdx]))
baselineMSE = np.sum(baselineMSE)/len(baselineMSE)
print(baselineMSE)
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-model">
<h2><span class="section-number">38.40.8. </span>Linear Model<a class="headerlink" href="#linear-model" title="Permalink to this headline">#</a></h2>
<p>Following good ML dev practice, let‚Äôs start with a linear model that uses the most informative feature from the correlation matrix: <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>. Even if this model performs badly, we can still use it as a baseline. This model should beat our previous baseline‚Äôs MSE of 0.75.</p>
<p>First, let‚Äôs define a function to plot our loss and accuracy curves. The function will also print the final loss and accuracy. Instead of using <code class="docutils literal notranslate"><span class="pre">verbose=1</span></code>, you can call the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def showRegressionResults(trainHistory):
  &quot;&quot;&quot;Function to:
   * Print final loss.
   * Plot loss curves.
  
  Args:
    trainHistory: object returned by model.fit
  &quot;&quot;&quot;
  
  # Print final loss
  print(&quot;Final training loss: &quot; + str(trainHistory.history[&#39;loss&#39;][-1]))
  print(&quot;Final Validation loss: &quot; + str(trainHistory.history[&#39;val_loss&#39;][-1]))
  
  # Plot loss curves
  plt.plot(trainHistory.history[&#39;loss&#39;])
  plt.plot(trainHistory.history[&#39;val_loss&#39;])
  plt.legend([&#39;Training loss&#39;,&#39;Validation loss&#39;],loc=&#39;best&#39;)
  plt.title(&#39;Loss Curves&#39;)
</pre></div>
</div>
</div>
</div>
<p>For fast prototyping, let‚Äôs try using a full batch per epoch to update the gradient only once per  epoch. Use the full batch by setting <code class="docutils literal notranslate"><span class="pre">batch_size</span> <span class="pre">=</span> <span class="pre">wineFeatures.shape[0]</span></code> as indicated by the code comment.</p>
<p>What do you think of the loss curve? Can you improve it? For hints and discussion, see the following text cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Choose feature
wineFeaturesSimple = wineFeatures[&#39;alcohol&#39;]
# Define model
model = keras.Sequential()
model.add(keras.layers.Dense(units=1, activation=&#39;linear&#39;, input_dim=1))
# Specify the optimizer using the TF API to specify the learning rate
model.compile(optimizer=tf.optimizers.Adam(learning_rate=0.01),
              loss=&#39;mse&#39;)
# Train the model!
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=50,
                         batch_size=, # set batch size here
                         validation_split=0.2,
                         verbose=0)
# Plot
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
<section id="hint">
<h3><span class="section-number">38.40.8.1. </span>Hint<a class="headerlink" href="#hint" title="Permalink to this headline">#</a></h3>
<p>The loss decreases but very slowly. Possible fixes are:</p>
<ul class="simple">
<li><p>Increase number of epochs.</p></li>
<li><p>Increase learning rate.</p></li>
<li><p>Decrease batch size. A lower batch size can result in larger decrease in loss per epoch, under the assumption that the smaller batches stay representative of the overall data distribution.</p></li>
</ul>
<p>Play with these three parameters in the code above to decrease the loss.</p>
</section>
<section id="id1">
<h3><span class="section-number">38.40.8.2. </span>Solution<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Run the following code cell to train the model using a reduced batch size of 100. Reducing the batch size leads to a greater decrease in loss per epoch. The minimum achievable loss is about 0.64. This is a significant increase over our baseline of 0.75.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Choose feature
wineFeaturesSimple = wineFeatures[&#39;alcohol&#39;]
# Define model
model = keras.Sequential()
model.add(keras.layers.Dense(units=1, activation=&#39;linear&#39;, input_dim=1))
# Specify the optimizer using the TF API to specify the learning rate
model.compile(optimizer=tf.optimizers.Adam(learning_rate=0.01),
              loss=&#39;mse&#39;)
# Train the model!
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=20,
                         batch_size=100, # set batch size here
                         validation_split=0.2,
                         verbose=0)
# Plot
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="add-feature-to-linear-model">
<h2><span class="section-number">38.40.9. </span>Add Feature to Linear Model<a class="headerlink" href="#add-feature-to-linear-model" title="Permalink to this headline">#</a></h2>
<p>Try adding a feature to the linear model. Since you need to combine the two features into one prediction for regression, you‚Äôll also need to add a second layer. Modify the code below to implement the following changes:</p>
<ol class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">'volatile</span> <span class="pre">acidity'</span></code> to the features in <code class="docutils literal notranslate"><span class="pre">wineFeaturesSimple</span></code>.</p></li>
<li><p>Add a second linear layer with 1 unit.</p></li>
<li><p>Experiment with learning rate, epochs, and batch_size to try to reduce loss.</p></li>
</ol>
<p>What happens to your loss?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Select features
wineFeaturesSimple = wineFeatures[[&#39;alcohol&#39;, &#39;...&#39;]] # add &#39;volatile acidity&#39;
# Define model
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             input_dim=wineFeaturesSimple.shape[1],
                             activation=&#39;linear&#39;))
model.add(...) # add second layer
# Compile
model.compile(optimizer=tf.optimizers.Adam(learning_rate=), loss=&#39;mse&#39;)
# Train
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=,
                         batch_size=,
                         validation_split=0.2,
                         verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3><span class="section-number">38.40.9.1. </span>Solution<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p>Run the following code to add the second feature and the second layer. The training loss is about 0.59, a small decrease from the previous loss of 0.64.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Select features
wineFeaturesSimple = wineFeatures[[&#39;alcohol&#39;, &#39;volatile acidity&#39;]] # add second feature
# Define model
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             input_dim=wineFeaturesSimple.shape[1],
                             activation=&#39;linear&#39;))
model.add(keras.layers.Dense(1, activation=&#39;linear&#39;)) # add second layer
# Compile
model.compile(optimizer=tf.optimizers.Adam(learning_rate=0.01), loss=&#39;mse&#39;)
# Train
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=20,
                         batch_size=100,
                         validation_split=0.2,
                         verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="use-a-nonlinear-model">
<h2><span class="section-number">38.40.10. </span>Use a Nonlinear Model<a class="headerlink" href="#use-a-nonlinear-model" title="Permalink to this headline">#</a></h2>
<p>Let‚Äôs try a nonlinear model. Modify the code below to make the following changes:</p>
<ol class="simple">
<li><p>Change the first layer to use <code class="docutils literal notranslate"><span class="pre">relu</span></code>. (Output layer stays linear since this is a regression problem.)</p></li>
<li><p>As usual, specify the learning rate, epochs, and batch_size.</p></li>
</ol>
<p>Run the cell. Does the loss increase, decrease, or stay the same?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Define
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             input_dim=wineFeaturesSimple.shape[1],
                             activation=))
model.add(keras.layers.Dense(1, activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;)
# Fit
model.fit(wineFeaturesSimple,
          wineLabels,
          epochs=,
          batch_size=,
          validation_split=0.2,
          verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h3><span class="section-number">38.40.10.1. </span>Solution<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<p>Run the following cell to use a <code class="docutils literal notranslate"><span class="pre">relu</span></code> activation in your first hidden layer. Your loss stays about the same, perhaps declining negligibly to 0.58.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Define
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             input_dim=wineFeaturesSimple.shape[1],
                             activation=&#39;relu&#39;))
model.add(keras.layers.Dense(1, activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;)
# Fit
model.fit(wineFeaturesSimple,
          wineLabels,
          epochs=20,
          batch_size=100,
          validation_split=0.2,
          verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="optimize-your-model">
<h2><span class="section-number">38.40.11. </span>Optimize Your Model<a class="headerlink" href="#optimize-your-model" title="Permalink to this headline">#</a></h2>
<p>We have two features with one hidden layer but didn‚Äôt see an improvement. At this point, it‚Äôs tempting to use all your features with a high-capacity network. However, you must resist the temptation. Instead, follow the guidance in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/optimization">Model Optimization</a> to improve model performance. For a hint and for a discussion, see the following text sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Choose features
wineFeaturesSimple = wineFeatures[[&#39;alcohol&#39;, &#39;volatile acidity&#39;]] # add features
# Define
model = None
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             activation=&#39;relu&#39;,
                             input_dim=wineFeaturesSimple.shape[1]))
# Add more layers here
model.add(keras.layers.Dense(1,activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;)
# Train
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=,
                         batch_size=,
                         validation_split=0.2,
                         verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3><span class="section-number">38.40.11.1. </span>Hint<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>You can try to reduce loss by adding features, adding layers, or playing with the hyperparameters. Before adding more features, check the correlation matrix. Don‚Äôt expect your loss to decrease by much. Sadly, that is a common experience in machine learning!</p>
</section>
<section id="id5">
<h3><span class="section-number">38.40.11.2. </span>Solution<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>Run the following code to:</p>
<ul class="simple">
<li><p>Add the features chlorides and density.</p></li>
<li><p>Set training epochs to 100.</p></li>
<li><p>Set batch size to 100.</p></li>
</ul>
<p>Your loss reduces to about 0.56. That‚Äôs a minor improvement over the previous loss of 0.58. It seems that adding more features or capacity isn‚Äôt improving your model by much. Perhaps your model has a bug? In the next section, you will run a sanity check on your model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Choose features
wineFeaturesSimple = wineFeatures[[&#39;alcohol&#39;,&#39;volatile acidity&#39;,&#39;chlorides&#39;,&#39;density&#39;]]
# Define
model = None
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSimple.shape[1],
                             activation=&#39;relu&#39;,
                             input_dim=wineFeaturesSimple.shape[1]))
# Add more layers here
model.add(keras.layers.Dense(1,activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;)
# Train
trainHistory = model.fit(wineFeaturesSimple,
                         wineLabels,
                         epochs=200,
                         batch_size=100,
                         validation_split=0.2,
                         verbose=0)
# Plot results
showRegressionResults(trainHistory)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="check-for-implementation-bugs-using-reduced-dataset">
<h2><span class="section-number">38.40.12. </span>Check for Implementation Bugs using Reduced Dataset<a class="headerlink" href="#check-for-implementation-bugs-using-reduced-dataset" title="Permalink to this headline">#</a></h2>
<p>Your loss isn‚Äôt decreasing by much. Perhaps your model has an implementation bug. From the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/model-errors">Model Debugging</a> guidelines, a quick test for implementation bugs is to obtain a low loss on a reduced dataset of, say, 10 examples. Remember, passing this test does not validate your modeling approach but only checks for basic implementation bugs. In your ML problem, if your model passes this test, then continue debugging your model to train on your full dataset.</p>
<p>In the following code, experiment with the learning rate, batch size, and number of epochs. Can you reach a low loss? Choose hyperparameter values that let you iterate quickly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Choose 10 examples
wineFeaturesSmall = wineFeatures[0:10]
wineLabelsSmall = wineLabels[0:10]
# Define model
model = None
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSmall.shape[1],
                             activation=&#39;relu&#39;,
                             input_dim=wineFeaturesSmall.shape[1]))
model.add(keras.layers.Dense(wineFeaturesSmall.shape[1], activation=&#39;relu&#39;))
model.add(keras.layers.Dense(1, activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;) # set LR
# Train
trainHistory = model.fit(wineFeaturesSmall,
                        wineLabelsSmall,
                        epochs=,
                        batch_size=,
                        verbose=0)
# Plot results
print(&quot;Final training loss: &quot; + str(trainHistory.history[&#39;loss&#39;][-1]))
plt.plot(trainHistory.history[&#39;loss&#39;])
</pre></div>
</div>
</div>
</div>
<section id="id6">
<h3><span class="section-number">38.40.12.1. </span>Solution<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>Run the following code cell to train the model using these hyperparameter values:</p>
<ul class="simple">
<li><p>learning rate = 0.01</p></li>
<li><p>epochs = 200</p></li>
<li><p>batch size = 10</p></li>
</ul>
<p>You get a low loss on your reduced dataset. This result means your model is probably solid and your previous results are as good as they‚Äôll get.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Choose 10 examples
wineFeaturesSmall = wineFeatures[0:10]
wineLabelsSmall = wineLabels[0:10]
# Define model
model = None
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeaturesSmall.shape[1], activation=&#39;relu&#39;,
                             input_dim=wineFeaturesSmall.shape[1]))
model.add(keras.layers.Dense(wineFeaturesSmall.shape[1], activation=&#39;relu&#39;))
model.add(keras.layers.Dense(1, activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(0.01), loss=&#39;mse&#39;) # set LR
# Train
trainHistory = model.fit(wineFeaturesSmall,
                        wineLabelsSmall,
                        epochs=200,
                        batch_size=10,
                        verbose=0)
# Plot results
print(&quot;Final training loss: &quot; + str(trainHistory.history[&#39;loss&#39;][-1]))
plt.plot(trainHistory.history[&#39;loss&#39;])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="trying-a-very-complex-model">
<h2><span class="section-number">38.40.13. </span>Trying a Very Complex Model<a class="headerlink" href="#trying-a-very-complex-model" title="Permalink to this headline">#</a></h2>
<p>Let‚Äôs go all in and use a very complex model with all the features. For science! And to satisfy ourselves that a simple model is indeed better. Let‚Äôs use all 11 features with 3 fully-connected relu layers and a final linear layer. The next cell takes a while to run. Skip to the results in the cell after if you like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model = None
# Define
model = keras.Sequential()
model.add(keras.layers.Dense(wineFeatures.shape[1], activation=&#39;relu&#39;,
                             input_dim=wineFeatures.shape[1]))
model.add(keras.layers.Dense(wineFeatures.shape[1], activation=&#39;relu&#39;))
model.add(keras.layers.Dense(wineFeatures.shape[1], activation=&#39;relu&#39;))
model.add(keras.layers.Dense(1,activation=&#39;linear&#39;))
# Compile
model.compile(optimizer=tf.optimizers.Adam(), loss=&#39;mse&#39;)
# Train the model!
trainHistory = model.fit(wineFeatures, wineLabels, epochs=100, batch_size=100,
                         verbose=1, validation_split = 0.2)
# Plot results
showRegressionResults(trainHistory)
plt.ylim(0.4,1)
</pre></div>
</div>
</div>
</div>
<section id="results">
<h3><span class="section-number">38.40.13.1. </span>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h3>
<p>If you train for long enough, the minimum achievable MSE is around 0.52, which is a decrease of 0.04 from the previous best loss of 0.56. This decrease probably isn‚Äôt worth the performance and complexity cost of using all your features and a deeper network. However, that decision depends on the objectives you‚Äôre optimizing for.</p>
<p>If you train the model long enough, the validation loss actually starts increasing while training loss continues to decrease. This divergence in loss curves means your model is overfitting. The overfitting results from the closer fit that your very complex model can learn. Stick with the simpler model. You‚Äôll be happier and live longer!</p>
<p>If you do want to optimize your loss, then play with the model to find the minimum achievable training loss before overfitting sets in. Try playing with the network parameters in the code cell above to achieve a loss of 0.51. But be warned‚Äîoptimizing your loss could take a lot of trial and error..</p>
</section>
</section>
<section id="conclusion">
<h2><span class="section-number">38.40.14. </span>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>This Colab demonstrated the following principles:</p>
<ul class="simple">
<li><p>The most important step in machine learning is understanding your data.</p></li>
<li><p>The largest gains come from the initial features and network.</p></li>
<li><p>Returns diminish as you add features and complexity.</p></li>
<li><p>Incremental development provides confidence in model quality and allows benchmarking against previous results.</p></li>
<li><p>Reproducing previous results is extremely important. Hence, always use version control.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "open-academy/machine-learning",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./assignments/machine-learning-productionization"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="debugging-in-classification.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">38.39. </span>Case Study: Debugging in Classification</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../slides/introduction.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">39. </span>Slides</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Open Academy<br/>
  
      &copy; Copyright 2022-2022.<br/>
    <div class="extra_footer">
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a> Text content of this work is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>